image: debian:bookworm

stages:
  - build
  - test
  - deploy

variables:
  GIT_SUBMODULE_STRATEGY: none

before_script:
  # System-Dependencies installieren
  - echo 'deb http://deb.debian.org/debian bookworm main contrib non-free non-free-firmware' > /etc/apt/sources.list
  - apt update
  - apt install -y --no-install-recommends build-essential git openssh-client cmake libasound2-dev libjack-jackd2-dev ladspa-sdk libcurl4-openssl-dev libfreetype6-dev libx11-dev libxcursor-dev libxext-dev libxinerama-dev libxrandr-dev libxrender-dev libxcomposite-dev libwebkit2gtk-4.0-dev libfontconfig1-dev mesa-common-dev ca-certificates
  # Git Repository manuell klonen inkl. Submodules
  - git submodule init
  # JUCE Submodule-URL überschreiben (SSH → HTTPS)
  - git config submodule.modules/tracktion_engine/modules/juce.url https://github.com/juce-framework/JUCE.git
  - git submodule update --recursive
build:
  stage: build
  script:
    # Annahme: tracktion_engine ist Submodule oder Teil des Repos
    - mkdir -p build
    - cd build
    - cmake ..
    - cmake --build .
  artifacts:
    paths:
      - build/

test:
  stage: test
  script:
    - echo "Hier könnten Unit-Tests laufen"

deploy:
  stage: deploy
  script:
    - echo "Define your deployment script!"
  environment: production
